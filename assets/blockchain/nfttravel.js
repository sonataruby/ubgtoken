SmartApp = (function (SmartApp, $, window) {
    "use strict";
    let GAS = 21000; 
    let blockchain = SmartApp.Blockchain;
    var login_wallet;
    let TokenAddress = "0x792233f7E5d2047a8da94B9113292f478A5AAD0c";
    let Abi = JSON.parse("[{\"inputs\": [],\"stateMutability\": \"nonpayable\",\"type\": \"constructor\"},{\"anonymous\": false,\"inputs\": [{\"indexed\": true,\"internalType\": \"address\",\"name\": \"owner\",\"type\": \"address\"},{\"indexed\": true,\"internalType\": \"address\",\"name\": \"approved\",\"type\": \"address\"},{\"indexed\": true,\"internalType\": \"uint256\",\"name\": \"tokenId\",\"type\": \"uint256\"}],\"name\": \"Approval\",\"type\": \"event\"},{\"anonymous\": false,\"inputs\": [{\"indexed\": true,\"internalType\": \"address\",\"name\": \"owner\",\"type\": \"address\"},{\"indexed\": true,\"internalType\": \"address\",\"name\": \"operator\",\"type\": \"address\"},{\"indexed\": false,\"internalType\": \"bool\",\"name\": \"approved\",\"type\": \"bool\"}],\"name\": \"ApprovalForAll\",\"type\": \"event\"},{\"anonymous\": false,\"inputs\": [{\"indexed\": true,\"internalType\": \"address\",\"name\": \"owner\",\"type\": \"address\"},{\"indexed\": true,\"internalType\": \"uint256\",\"name\": \"id\",\"type\": \"uint256\"},{\"indexed\": false,\"internalType\": \"string\",\"name\": \"name\",\"type\": \"string\"},{\"indexed\": false,\"internalType\": \"uint256\",\"name\": \"start\",\"type\": \"uint256\"},{\"indexed\": false,\"internalType\": \"uint256\",\"name\": \"night\",\"type\": \"uint256\"},{\"indexed\": false,\"internalType\": \"uint256\",\"name\": \"bed\",\"type\": \"uint256\"},{\"indexed\": false,\"internalType\": \"uint256\",\"name\": \"sonam\",\"type\": \"uint256\"},{\"indexed\": false,\"internalType\": \"uint256\",\"name\": \"exitsaumoinam\",\"type\": \"uint256\"},{\"indexed\": false,\"internalType\": \"string\",\"name\": \"code\",\"type\": \"string\"},{\"indexed\": false,\"internalType\": \"uint256\",\"name\": \"opentime\",\"type\": \"uint256\"},{\"indexed\": false,\"internalType\": \"uint256\",\"name\": \"lastupdate\",\"type\": \"uint256\"}],\"name\": \"Minted\",\"type\": \"event\"},{\"anonymous\": false,\"inputs\": [{\"indexed\": false,\"internalType\": \"address\",\"name\": \"operator\",\"type\": \"address\"},{\"indexed\": false,\"internalType\": \"address\",\"name\": \"from\",\"type\": \"address\"},{\"indexed\": false,\"internalType\": \"uint256\",\"name\": \"tokenId\",\"type\": \"uint256\"},{\"indexed\": false,\"internalType\": \"bytes\",\"name\": \"data\",\"type\": \"bytes\"}],\"name\": \"NftReceived\",\"type\": \"event\"},{\"anonymous\": false,\"inputs\": [{\"indexed\": true,\"internalType\": \"address\",\"name\": \"previousOwner\",\"type\": \"address\"},{\"indexed\": true,\"internalType\": \"address\",\"name\": \"newOwner\",\"type\": \"address\"}],\"name\": \"OwnershipTransferred\",\"type\": \"event\"},{\"anonymous\": false,\"inputs\": [{\"indexed\": true,\"internalType\": \"address\",\"name\": \"from\",\"type\": \"address\"},{\"indexed\": true,\"internalType\": \"address\",\"name\": \"to\",\"type\": \"address\"},{\"indexed\": true,\"internalType\": \"uint256\",\"name\": \"tokenId\",\"type\": \"uint256\"}],\"name\": \"Transfer\",\"type\": \"event\"},{\"inputs\": [{\"internalType\": \"uint256\",\"name\": \"\",\"type\": \"uint256\"}],\"name\": \"BookingOf\",\"outputs\": [{\"internalType\": \"string\",\"name\": \"email\",\"type\": \"string\"},{\"internalType\": \"uint256\",\"name\": \"phone\",\"type\": \"uint256\"},{\"internalType\": \"string\",\"name\": \"name\",\"type\": \"string\"},{\"internalType\": \"string\",\"name\": \"passport\",\"type\": \"string\"},{\"internalType\": \"uint256\",\"name\": \"checkin\",\"type\": \"uint256\"},{\"internalType\": \"uint256\",\"name\": \"checkout\",\"type\": \"uint256\"},{\"internalType\": \"string\",\"name\": \"hotel\",\"type\": \"string\"},{\"internalType\": \"string\",\"name\": \"code\",\"type\": \"string\"}],\"stateMutability\": \"view\",\"type\": \"function\"},{\"inputs\": [{\"internalType\": \"address\",\"name\": \"\",\"type\": \"address\"}],\"name\": \"ClaimEventOf\",\"outputs\": [{\"internalType\": \"uint256\",\"name\": \"tokenId\",\"type\": \"uint256\"},{\"internalType\": \"string\",\"name\": \"code\",\"type\": \"string\"}],\"stateMutability\": \"view\",\"type\": \"function\"},{\"inputs\": [{\"internalType\": \"address\",\"name\": \"\",\"type\": \"address\"}],\"name\": \"RefundBookingOf\",\"outputs\": [{\"internalType\": \"uint256\",\"name\": \"tokenId\",\"type\": \"uint256\"},{\"internalType\": \"uint256\",\"name\": \"star\",\"type\": \"uint256\"},{\"internalType\": \"uint256\",\"name\": \"night\",\"type\": \"uint256\"},{\"internalType\": \"uint256\",\"name\": \"bed\",\"type\": \"uint256\"}],\"stateMutability\": \"view\",\"type\": \"function\"},{\"inputs\": [{\"internalType\": \"uint256\",\"name\": \"_tokenId\",\"type\": \"uint256\"},{\"internalType\": \"address\",\"name\": \"_address\",\"type\": \"address\"},{\"internalType\": \"string\",\"name\": \"_code\",\"type\": \"string\"}],\"name\": \"addEvents\",\"outputs\": [{\"internalType\": \"uint256\",\"name\": \"\",\"type\": \"uint256\"}],\"stateMutability\": \"nonpayable\",\"type\": \"function\"},{\"inputs\": [{\"internalType\": \"address\",\"name\": \"to\",\"type\": \"address\"},{\"internalType\": \"uint256\",\"name\": \"tokenId\",\"type\": \"uint256\"}],\"name\": \"approve\",\"outputs\": [],\"stateMutability\": \"nonpayable\",\"type\": \"function\"},{\"inputs\": [{\"internalType\": \"address\",\"name\": \"owner\",\"type\": \"address\"}],\"name\": \"balanceOf\",\"outputs\": [{\"internalType\": \"uint256\",\"name\": \"\",\"type\": \"uint256\"}],\"stateMutability\": \"view\",\"type\": \"function\"},{\"inputs\": [],\"name\": \"baseURI\",\"outputs\": [{\"internalType\": \"string\",\"name\": \"\",\"type\": \"string\"}],\"stateMutability\": \"view\",\"type\": \"function\"},{\"inputs\": [{\"internalType\": \"uint256\",\"name\": \"_tokenId\",\"type\": \"uint256\"},{\"internalType\": \"string\",\"name\": \"_name\",\"type\": \"string\"},{\"internalType\": \"uint256\",\"name\": \"_phone\",\"type\": \"uint256\"},{\"internalType\": \"string\",\"name\": \"_email\",\"type\": \"string\"},{\"internalType\": \"string\",\"name\": \"_passport\",\"type\": \"string\"},{\"internalType\": \"uint256\",\"name\": \"_checkin\",\"type\": \"uint256\"},{\"internalType\": \"uint256\",\"name\": \"_checkout\",\"type\": \"uint256\"},{\"internalType\": \"string\",\"name\": \"_hotel\",\"type\": \"string\"}],\"name\": \"bookingTour\",\"outputs\": [{\"internalType\": \"uint256\",\"name\": \"\",\"type\": \"uint256\"}],\"stateMutability\": \"nonpayable\",\"type\": \"function\"},{\"inputs\": [{\"internalType\": \"uint256\",\"name\": \"tokenId\",\"type\": \"uint256\"}],\"name\": \"burn\",\"outputs\": [],\"stateMutability\": \"nonpayable\",\"type\": \"function\"},{\"inputs\": [],\"name\": \"claimEvent\",\"outputs\": [{\"internalType\": \"uint256\",\"name\": \"\",\"type\": \"uint256\"}],\"stateMutability\": \"nonpayable\",\"type\": \"function\"},{\"inputs\": [{\"internalType\": \"uint256\",\"name\": \"tokenId\",\"type\": \"uint256\"}],\"name\": \"getApproved\",\"outputs\": [{\"internalType\": \"address\",\"name\": \"\",\"type\": \"address\"}],\"stateMutability\": \"view\",\"type\": \"function\"},{\"inputs\": [{\"internalType\": \"uint256\",\"name\": \"_tokenId\",\"type\": \"uint256\"}],\"name\": \"getExitTime\",\"outputs\": [{\"internalType\": \"uint256\",\"name\": \"\",\"type\": \"uint256\"}],\"stateMutability\": \"view\",\"type\": \"function\"},{\"inputs\": [{\"internalType\": \"uint256\",\"name\": \"_tokenId\",\"type\": \"uint256\"}],\"name\": \"getOptions\",\"outputs\": [{\"components\": [{\"internalType\": \"string\",\"name\": \"name\",\"type\": \"string\"},{\"internalType\": \"uint256\",\"name\": \"star\",\"type\": \"uint256\"},{\"internalType\": \"uint256\",\"name\": \"night\",\"type\": \"uint256\"},{\"internalType\": \"uint256\",\"name\": \"bed\",\"type\": \"uint256\"},{\"internalType\": \"uint256\",\"name\": \"songaymua\",\"type\": \"uint256\"},{\"internalType\": \"uint256\",\"name\": \"songayhetky\",\"type\": \"uint256\"},{\"internalType\": \"string\",\"name\": \"code\",\"type\": \"string\"},{\"internalType\": \"uint256\",\"name\": \"opentime\",\"type\": \"uint256\"},{\"internalType\": \"uint256\",\"name\": \"lastupdate\",\"type\": \"uint256\"},{\"internalType\": \"uint256\",\"name\": \"nightexit\",\"type\": \"uint256\"}],\"internalType\": \"struct TravelNFT.Params\",\"name\": \"\",\"type\": \"tuple\"}],\"stateMutability\": \"view\",\"type\": \"function\"},{\"inputs\": [{\"internalType\": \"address\",\"name\": \"_owner\",\"type\": \"address\"}],\"name\": \"getTokenOwner\",\"outputs\": [{\"internalType\": \"uint256[]\",\"name\": \"\",\"type\": \"uint256[]\"}],\"stateMutability\": \"view\",\"type\": \"function\"},{\"inputs\": [{\"internalType\": \"address\",\"name\": \"owner\",\"type\": \"address\"},{\"internalType\": \"address\",\"name\": \"operator\",\"type\": \"address\"}],\"name\": \"isApprovedForAll\",\"outputs\": [{\"internalType\": \"bool\",\"name\": \"\",\"type\": \"bool\"}],\"stateMutability\": \"view\",\"type\": \"function\"},{\"inputs\": [{\"internalType\": \"address\",\"name\": \"_to\",\"type\": \"address\"},{\"internalType\": \"uint256\",\"name\": \"_star\",\"type\": \"uint256\"},{\"internalType\": \"uint256\",\"name\": \"_night\",\"type\": \"uint256\"},{\"internalType\": \"uint256\",\"name\": \"_bed\",\"type\": \"uint256\"},{\"internalType\": \"uint256\",\"name\": \"_songaymua\",\"type\": \"uint256\"},{\"internalType\": \"uint256\",\"name\": \"_songayhetky\",\"type\": \"uint256\"},{\"internalType\": \"uint256\",\"name\": \"_exitmoiky\",\"type\": \"uint256\"}],\"name\": \"mintTickets\",\"outputs\": [{\"internalType\": \"uint256\",\"name\": \"\",\"type\": \"uint256\"}],\"stateMutability\": \"nonpayable\",\"type\": \"function\"},{\"inputs\": [],\"name\": \"name\",\"outputs\": [{\"internalType\": \"string\",\"name\": \"\",\"type\": \"string\"}],\"stateMutability\": \"view\",\"type\": \"function\"},{\"inputs\": [],\"name\": \"owner\",\"outputs\": [{\"internalType\": \"address\",\"name\": \"\",\"type\": \"address\"}],\"stateMutability\": \"view\",\"type\": \"function\"},{\"inputs\": [{\"internalType\": \"uint256\",\"name\": \"tokenId\",\"type\": \"uint256\"}],\"name\": \"ownerOf\",\"outputs\": [{\"internalType\": \"address\",\"name\": \"\",\"type\": \"address\"}],\"stateMutability\": \"view\",\"type\": \"function\"},{\"inputs\": [{\"internalType\": \"uint256\",\"name\": \"\",\"type\": \"uint256\"}],\"name\": \"paramsOf\",\"outputs\": [{\"internalType\": \"string\",\"name\": \"name\",\"type\": \"string\"},{\"internalType\": \"uint256\",\"name\": \"star\",\"type\": \"uint256\"},{\"internalType\": \"uint256\",\"name\": \"night\",\"type\": \"uint256\"},{\"internalType\": \"uint256\",\"name\": \"bed\",\"type\": \"uint256\"},{\"internalType\": \"uint256\",\"name\": \"songaymua\",\"type\": \"uint256\"},{\"internalType\": \"uint256\",\"name\": \"songayhetky\",\"type\": \"uint256\"},{\"internalType\": \"string\",\"name\": \"code\",\"type\": \"string\"},{\"internalType\": \"uint256\",\"name\": \"opentime\",\"type\": \"uint256\"},{\"internalType\": \"uint256\",\"name\": \"lastupdate\",\"type\": \"uint256\"},{\"internalType\": \"uint256\",\"name\": \"nightexit\",\"type\": \"uint256\"}],\"stateMutability\": \"view\",\"type\": \"function\"},{\"inputs\": [],\"name\": \"refundBooking\",\"outputs\": [{\"internalType\": \"uint256\",\"name\": \"\",\"type\": \"uint256\"}],\"stateMutability\": \"nonpayable\",\"type\": \"function\"},{\"inputs\": [],\"name\": \"renounceOwnership\",\"outputs\": [],\"stateMutability\": \"nonpayable\",\"type\": \"function\"},{\"inputs\": [{\"internalType\": \"address\",\"name\": \"from\",\"type\": \"address\"},{\"internalType\": \"address\",\"name\": \"to\",\"type\": \"address\"},{\"internalType\": \"uint256\",\"name\": \"tokenId\",\"type\": \"uint256\"}],\"name\": \"safeTransferFrom\",\"outputs\": [],\"stateMutability\": \"nonpayable\",\"type\": \"function\"},{\"inputs\": [{\"internalType\": \"address\",\"name\": \"from\",\"type\": \"address\"},{\"internalType\": \"address\",\"name\": \"to\",\"type\": \"address\"},{\"internalType\": \"uint256\",\"name\": \"tokenId\",\"type\": \"uint256\"},{\"internalType\": \"bytes\",\"name\": \"_data\",\"type\": \"bytes\"}],\"name\": \"safeTransferFrom\",\"outputs\": [],\"stateMutability\": \"nonpayable\",\"type\": \"function\"},{\"inputs\": [{\"internalType\": \"address\",\"name\": \"operator\",\"type\": \"address\"},{\"internalType\": \"bool\",\"name\": \"approved\",\"type\": \"bool\"}],\"name\": \"setApprovalForAll\",\"outputs\": [],\"stateMutability\": \"nonpayable\",\"type\": \"function\"},{\"inputs\": [{\"internalType\": \"string\",\"name\": \"_uri\",\"type\": \"string\"}],\"name\": \"setBaseUri\",\"outputs\": [],\"stateMutability\": \"nonpayable\",\"type\": \"function\"},{\"inputs\": [{\"internalType\": \"address\",\"name\": \"_factory\",\"type\": \"address\"}],\"name\": \"setFactory\",\"outputs\": [],\"stateMutability\": \"nonpayable\",\"type\": \"function\"},{\"inputs\": [{\"internalType\": \"uint256\",\"name\": \"_minday\",\"type\": \"uint256\"}],\"name\": \"setMinDayBooking\",\"outputs\": [{\"internalType\": \"uint256\",\"name\": \"\",\"type\": \"uint256\"}],\"stateMutability\": \"nonpayable\",\"type\": \"function\"},{\"inputs\": [{\"internalType\": \"uint256\",\"name\": \"_tokenId\",\"type\": \"uint256\"},{\"internalType\": \"string\",\"name\": \"_name\",\"type\": \"string\"},{\"internalType\": \"string\",\"name\": \"_code\",\"type\": \"string\"}],\"name\": \"setMintOptios\",\"outputs\": [{\"internalType\": \"uint256\",\"name\": \"\",\"type\": \"uint256\"}],\"stateMutability\": \"nonpayable\",\"type\": \"function\"},{\"inputs\": [{\"internalType\": \"uint256\",\"name\": \"_tokenId\",\"type\": \"uint256\"},{\"internalType\": \"string\",\"name\": \"_name\",\"type\": \"string\"},{\"internalType\": \"uint256\",\"name\": \"_star\",\"type\": \"uint256\"},{\"internalType\": \"uint256\",\"name\": \"_night\",\"type\": \"uint256\"},{\"internalType\": \"uint256\",\"name\": \"_bed\",\"type\": \"uint256\"},{\"internalType\": \"uint256\",\"name\": \"_exitsaumoinam\",\"type\": \"uint256\"}],\"name\": \"setOptions\",\"outputs\": [{\"internalType\": \"uint256\",\"name\": \"\",\"type\": \"uint256\"}],\"stateMutability\": \"nonpayable\",\"type\": \"function\"},{\"inputs\": [{\"internalType\": \"address\",\"name\": \"_owner\",\"type\": \"address\"}],\"name\": \"setOwner\",\"outputs\": [],\"stateMutability\": \"nonpayable\",\"type\": \"function\"},{\"inputs\": [{\"internalType\": \"bytes4\",\"name\": \"interfaceId\",\"type\": \"bytes4\"}],\"name\": \"supportsInterface\",\"outputs\": [{\"internalType\": \"bool\",\"name\": \"\",\"type\": \"bool\"}],\"stateMutability\": \"view\",\"type\": \"function\"},{\"inputs\": [],\"name\": \"symbol\",\"outputs\": [{\"internalType\": \"string\",\"name\": \"\",\"type\": \"string\"}],\"stateMutability\": \"view\",\"type\": \"function\"},{\"inputs\": [{\"internalType\": \"uint256\",\"name\": \"index\",\"type\": \"uint256\"}],\"name\": \"tokenByIndex\",\"outputs\": [{\"internalType\": \"uint256\",\"name\": \"\",\"type\": \"uint256\"}],\"stateMutability\": \"view\",\"type\": \"function\"},{\"inputs\": [{\"internalType\": \"address\",\"name\": \"owner\",\"type\": \"address\"},{\"internalType\": \"uint256\",\"name\": \"index\",\"type\": \"uint256\"}],\"name\": \"tokenOfOwnerByIndex\",\"outputs\": [{\"internalType\": \"uint256\",\"name\": \"\",\"type\": \"uint256\"}],\"stateMutability\": \"view\",\"type\": \"function\"},{\"inputs\": [{\"internalType\": \"uint256\",\"name\": \"tokenId\",\"type\": \"uint256\"}],\"name\": \"tokenURI\",\"outputs\": [{\"internalType\": \"string\",\"name\": \"\",\"type\": \"string\"}],\"stateMutability\": \"view\",\"type\": \"function\"},{\"inputs\": [],\"name\": \"totalSupply\",\"outputs\": [{\"internalType\": \"uint256\",\"name\": \"\",\"type\": \"uint256\"}],\"stateMutability\": \"view\",\"type\": \"function\"},{\"inputs\": [{\"internalType\": \"address\",\"name\": \"from\",\"type\": \"address\"},{\"internalType\": \"address\",\"name\": \"to\",\"type\": \"address\"},{\"internalType\": \"uint256\",\"name\": \"tokenId\",\"type\": \"uint256\"}],\"name\": \"transferFrom\",\"outputs\": [],\"stateMutability\": \"nonpayable\",\"type\": \"function\"},{\"inputs\": [{\"internalType\": \"address\",\"name\": \"newOwner\",\"type\": \"address\"}],\"name\": \"transferOwnership\",\"outputs\": [],\"stateMutability\": \"nonpayable\",\"type\": \"function\"}]");
    var TravelContact;
    
   
    SmartApp.Travel = {};
    
    SmartApp.Travel.loadContracts = async () => {

            var contractLoader = await blockchain.loadContract(TokenAddress,Abi);
            TravelContact = contractLoader.methods;
            login_wallet = await blockchain.getLoginWallet();
            return true;
    }
    
    SmartApp.Travel.getContractAddress = ()=>{
        return TokenAddress;
    }

    SmartApp.Travel.setFatory = async (address) => {

            await TravelContact.setFactory(address).send();
    }

    
    SmartApp.Travel.getMyNFT = async (htmlItem, _class, _target) => {
        if(TravelContact == undefined) await SmartApp.Travel.init();
        
        //SmartApp.Travel.MakeHtml = '';
        let Items = await TravelContact.getTokenOwner(login_wallet).call().then(async (data)=>{
           var dataItems = [];
           for (var i = 0; i < data.length; i++) {
               let token_id = data[i];
               let token = await TravelContact.getOptions(token_id).call();
               //console.log(Object.keys(dataToken));
               var html = htmlItem;
                html = html.replace('{name}',token.name);
                html = html.replace('{star}',token.star);
                html = html.replace('{bed}',token.bed);
                html = html.replace('{night}',token.night);
                html = html.replace('{opentime}',moment.unix(token.opentime).format('DD-MM-YYYY HH:mm:ss'));
                html = html.replace('{exittime}',moment.unix(Number(token.opentime) + Number(token.songaymua) * 84600).format('DD-MM-YYYY HH:mm:ss'));
                html = html.replace('{lastupdate}',moment.unix(token.lastupdate).format('DD-MM-YYYY HH:mm:ss'));
                html = html.replace('{songayhetky}',token.songayhetky);
                html = html.replace('{songaymua}',token.songaymua);
                html = html.replace('{banner}','src="/'+token.code+'"');
                html = html.replaceAll("{item_id}",token_id);
                //html = '<div class="'+_class+'">'+html+'</div>';
                dataItems.push(html);
           }
            
            return dataItems;
            
        });
        
        var htmlOutput = "";
        for (var i = 0; i < Items.length; i++) {
            htmlOutput += '<div class="'+_class+'">'+Items[i]+'</div>';
        }
        $("#"+_target).html(htmlOutput);
        return true;
    }

    SmartApp.Travel.bookingTour = async (obj) =>{
        let data = await TravelContact.bookingTour(obj.tokenid, obj.name, Number(obj.phone), obj.email, Number(obj.passport), Number(obj.checkin), Number(obj.checkout), Number(obj.hotel)).send({gas:300000}).then((data) =>{
            console.log(data);
        });
    }
    SmartApp.Travel.init = async () => {
        await blockchain.init();
        await SmartApp.Travel.loadContracts();
        //const balance = await Token.methods.balanceOf(login_wallet);
        //$(".balance").html(balance);
    }
    SmartApp.components.docReady.push(SmartApp.Travel.init);
    return SmartApp;
})(SmartApp, jQuery, window);